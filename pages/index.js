import { useEffect, useState } from 'react';
import Head from 'next/head';
import Group from '../components/Group';
import styles from '../styles/Home.module.css';

export default function Home() {
	const [matches, setMatches] = useState([]);
	const [flags, setFlags] = useState([]);

	useEffect(() => {
		window
			.fetch('/api/')
			.then((res) => res.json())
			.then(({ data }) => {
				setMatches(data);
			});
	}, []);

	useEffect(() => {
		window
			.fetch('/api/flags')
			.then((res) => res.json())
			.then(({ data }) => {
				setFlags(data);
			});
	}, []);

	const allGroups = [];
	matches.map(({ Group }) => {
		if (typeof Group == 'string') {
			allGroups.push(Group);
		}
	});
	const groupList = [...new Set(allGroups)];
	return (
		<div>
			<Head>
				<title>Fixture Mundial Qatar 2022</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
				<meta
					name='viewport'
					content='width=device-width, initial-scale=1, maximum-scale=1'
				></meta>
			</Head>
			<main>
				<header>
					<h1 className={styles.title}>
						<a>Fixture Mundial Qatar 2022</a>
					</h1>
				</header>
				<div className={styles.container}>
					{groupList.map((groups) => (
						<section key={groups} className={styles.groups}>
							<Group matches={matches} group={groups} flags={flags} />
						</section>
					))}
				</div>
			</main>
		</div>
	);
}
